/* ════════════════════════════════════════════════════════════
   MESSAGES SECTION
   ════════════════════════════════════════════════════════════ */

.messages-layout {
  display              : grid;
  grid-template-columns: 260px 1fr;
  gap                  : 0;
  /* Height handled by flex from .section-messages-active on .dash-content */
  min-height           : 420px;
  background           : var(--dash-surface2);
  border               : 1px solid var(--dash-border);
  border-radius        : 10px;
  overflow             : hidden;
  /* Fallback fixed height when not in full-height mode */
  height               : calc(100vh - var(--dash-topbar-h) - 120px);
}

@media (max-width: 700px) {
  .messages-layout { grid-template-columns: 1fr; }
  .msg-chat-pane   { display: none; }
  .messages-layout.conv-open .msg-conv-pane { display: none; }
  .messages-layout.conv-open .msg-chat-pane { display: flex; }
}

/* ── Left pane — conversation list ──────────────────────────── */
.msg-conv-pane {
  display       : flex;
  flex-direction: column;
  border-right  : 1px solid var(--dash-border);
  overflow      : hidden;
}

.msg-conv-header {
  display        : flex;
  align-items    : center;
  justify-content: space-between;
  padding        : 14px 16px 10px;
  border-bottom  : 1px solid var(--dash-border2);
  flex-shrink    : 0;
}

.msg-conv-title {
  font-size     : 11px;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color         : var(--dash-text-dim);
}

.msg-new-btn {
  background    : none;
  border        : 1px solid rgba(0,212,255,0.2);
  border-radius : 5px;
  color         : var(--dash-accent);
  cursor        : pointer;
  padding       : 4px 8px;
  font-family   : var(--font-mono);
  font-size     : 10px;
  letter-spacing: 0.1em;
  transition    : background 0.18s, border-color 0.18s;
}
.msg-new-btn:hover {
  background  : rgba(0,212,255,0.08);
  border-color: rgba(0,212,255,0.45);
}

.msg-search-wrap {
  padding     : 10px 12px;
  border-bottom: 1px solid var(--dash-border2);
  flex-shrink : 0;
}

.msg-search {
  width        : 100%;
  background   : var(--dash-surface);
  border       : 1px solid var(--dash-border);
  border-radius: 5px;
  color        : var(--dash-text);
  font-family  : var(--font-mono);
  font-size    : 11px;
  padding      : 7px 10px;
  outline      : none;
  transition   : border-color 0.18s;
  box-sizing   : border-box;
}
.msg-search:focus { border-color: rgba(0,212,255,0.4); }

.msg-conv-list {
  flex       : 1;
  overflow-y : auto;
  scrollbar-width: thin;
  scrollbar-color: rgba(0,212,255,0.15) transparent;
}

.msg-conv-item {
  display        : flex;
  align-items    : center;
  gap            : 10px;
  width          : 100%;
  padding        : 11px 14px;
  background     : none;
  border         : none;
  border-bottom  : 1px solid var(--dash-border2);
  cursor         : pointer;
  text-align     : left;
  transition     : background 0.16s;
}
.msg-conv-item:hover { background: rgba(0,212,255,0.04); }
.msg-conv-item.active { background: rgba(0,212,255,0.08); border-left: 2px solid var(--dash-accent); }

.msg-conv-avatar {
  width           : 34px;
  height          : 34px;
  border-radius   : 50%;
  background      : rgba(0,212,255,0.1);
  border          : 1px solid rgba(0,212,255,0.2);
  display         : flex;
  align-items     : center;
  justify-content : center;
  font-size       : 14px;
  font-weight     : 700;
  color           : var(--dash-accent);
  flex-shrink     : 0;
  position        : relative;
  overflow        : hidden;
}

.msg-conv-info {
  flex     : 1;
  min-width: 0;
  display  : flex;
  flex-direction: column;
  gap      : 3px;
}

.msg-conv-name {
  font-size     : 11.5px;
  color         : var(--dash-text);
  letter-spacing: 0.04em;
  white-space   : nowrap;
  overflow      : hidden;
  text-overflow : ellipsis;
}

.msg-conv-preview {
  font-size    : 10px;
  color        : var(--dash-text-faint);
  white-space  : nowrap;
  overflow     : hidden;
  text-overflow: ellipsis;
}

.msg-conv-preview--game {
  font-size  : 10px;
  color      : #00d4ff;
  opacity    : 0.8;
  white-space: nowrap;
  overflow   : hidden;
  text-overflow: ellipsis;
}

.msg-conv-time {
  font-size  : 9.5px;
  color      : var(--dash-text-faint);
  flex-shrink: 0;
}

.msg-loading, .msg-error {
  padding   : 20px;
  font-size : 11px;
  color     : var(--dash-text-faint);
  text-align: center;
}

/* ── Right pane — chat area ─────────────────────────────────── */
.msg-chat-pane {
  display       : flex;
  flex-direction: column;
  overflow      : hidden;
}

.msg-chat-header {
  display     : flex;
  align-items : center;
  gap         : 10px;
  padding     : 12px 18px;
  border-bottom: 1px solid var(--dash-border);
  flex-shrink : 0;
  min-height  : 53px;
}

.msg-chat-avatar {
  width           : 32px;
  height          : 32px;
  border-radius   : 50%;
  background      : rgba(0,212,255,0.1);
  border          : 1px solid rgba(0,212,255,0.2);
  display         : flex;
  align-items     : center;
  justify-content : center;
  font-size       : 13px;
  font-weight     : 700;
  color           : var(--dash-accent);
  flex-shrink     : 0;
  position        : relative;
  overflow        : hidden;
}

.msg-chat-name {
  font-size     : 12px;
  letter-spacing: 0.06em;
  color         : var(--dash-text);
}

.msg-chat-empty {
  flex           : 1;
  display        : flex;
  align-items    : center;
  justify-content: center;
}

.msg-chat-feed {
  flex       : 1;
  overflow-y : auto;
  padding    : 16px 18px;
  display    : flex;
  flex-direction: column;
  gap        : 8px;
  scrollbar-width: thin;
  scrollbar-color: rgba(0,212,255,0.12) transparent;
}

/* ── Bubbles ─────────────────────────────────────────────────── */
.msg-bubble {
  display       : flex;
  flex-direction: column;
  align-items   : flex-start;
  max-width     : 72%;
  align-self    : flex-start;
}

.msg-bubble--self {
  align-items: flex-end;
  align-self : flex-end;
}

.msg-bubble-text {
  background    : var(--dash-surface3);
  border        : 1px solid var(--dash-border);
  border-radius : 8px 8px 8px 2px;
  padding       : 8px 12px;
  font-size     : 12px;
  color         : var(--dash-text);
  line-height   : 1.5;
  word-break    : break-word;
}

.msg-bubble--self .msg-bubble-text {
  background    : rgba(0,212,255,0.1);
  border-color  : rgba(0,212,255,0.25);
  border-radius : 8px 8px 2px 8px;
  color         : #e4e8f4;
}

.msg-bubble-ts {
  font-size  : 9px;
  color      : var(--dash-text-faint);
  margin-top : 3px;
  letter-spacing: 0.05em;
}

.msg-feed-error {
  font-size: 10.5px;
  color    : var(--dash-red);
  padding  : 6px 0;
}

/* ── Input bar ───────────────────────────────────────────────── */
.msg-input-bar {
  display     : flex;
  align-items : center;
  gap         : 10px;
  padding     : 12px 16px;
  border-top  : 1px solid var(--dash-border);
  flex-shrink : 0;
}

.msg-input {
  flex         : 1;
  background   : var(--dash-surface);
  border       : 1px solid var(--dash-border);
  border-radius: 6px;
  color        : var(--dash-text);
  font-family  : var(--font-mono);
  font-size    : 12px;
  padding      : 9px 12px;
  outline      : none;
  transition   : border-color 0.18s;
  resize       : none;
  height       : 38px;
  max-height   : 120px;
}
.msg-input:focus{ border-color: rgba(0,212,255,0.4); }
.msg-input:disabled { opacity: 0.4; }

.msg-send-btn {
  background    : rgba(0,212,255,0.1);
  border        : 1px solid rgba(0,212,255,0.3);
  border-radius : 6px;
  color         : var(--dash-accent);
  cursor        : pointer;
  padding       : 8px 14px;
  font-family   : var(--font-mono);
  font-size     : 11px;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  transition    : background 0.18s, border-color 0.18s;
  flex-shrink   : 0;
}
.msg-send-btn:hover:not(:disabled) {
  background  : rgba(0,212,255,0.2);
  border-color: rgba(0,212,255,0.6);
}
.msg-send-btn:disabled { opacity: 0.35; cursor: not-allowed; }

/* ── Empty states ────────────────────────────────────────────── */
.msg-chat-empty {
  flex           : 1;
  display        : flex;
  flex-direction : column;
  align-items    : center;
  justify-content: center;
  gap            : 10px;
  color          : var(--dash-text-faint);
  font-size      : 11px;
  text-align     : center;
  padding        : 20px;
}
.msg-conv-empty {
  list-style: none;
  padding   : 28px 16px;
  font-size : 10.5px;
  color     : var(--dash-text-faint);
  text-align: center;
  line-height: 1.7;
}

/* ── New message inline search row ──────────────────────────── */
.msg-new-row {
  display      : flex;
  align-items  : center;
  gap          : 6px;
  padding      : 0 10px 8px;
  flex-shrink  : 0;
  border-bottom: 1px solid var(--dash-border2);
  animation    : dashSectionIn 0.18s ease both;
}

.msg-new-row .msg-search {
  flex        : 1;
  box-sizing  : border-box;
  width       : 100%;
}

.msg-new-cancel {
  background   : none;
  border       : none;
  color        : var(--dash-text-faint);
  cursor       : pointer;
  font-size    : 13px;
  padding      : 4px 6px;
  border-radius: 4px;
  line-height  : 1;
  transition   : color 0.15s;
}
.msg-new-cancel:hover { color: #ff4d6a; }

/* ── Toolbar row (search + new button) ───────────────────────── */
.msg-conv-toolbar {
  display     : flex;
  align-items : center;
  gap         : 8px;
  padding     : 10px 10px 8px;
  border-bottom: 1px solid var(--dash-border2);
  flex-shrink : 0;
}

.msg-conv-toolbar .msg-search-wrap {
  position   : relative;
  flex       : 1;
  padding    : 0;
  border     : none;
}

.msg-conv-toolbar .msg-search-wrap svg {
  position : absolute;
  left     : 9px;
  top      : 50%;
  transform: translateY(-50%);
  width    : 12px;
  height   : 12px;
  stroke   : var(--dash-text-faint);
  fill     : none;
  stroke-width: 1.8;
  stroke-linecap: round;
  pointer-events: none;
}

.msg-conv-toolbar .msg-search {
  padding-left: 28px;
  width       : 100%;
  box-sizing  : border-box;
}

.msg-conv-toolbar .msg-new-btn {
  flex-shrink    : 0;
  display        : flex;
  align-items    : center;
  justify-content: center;
  padding        : 7px 11px;
  background     : none;
  border         : 1px solid rgba(0, 212, 255, 0.25);
  border-radius  : 5px;
  color          : var(--dash-accent);
  cursor         : pointer;
  transition     : background 0.18s, border-color 0.18s;
  line-height    : 1;
}

.msg-conv-toolbar .msg-new-btn:hover {
  background  : rgba(0, 212, 255, 0.08);
  border-color: rgba(0, 212, 255, 0.5);
}

/* ── Chat header name ────────────────────────────────────────── */
.msg-chat-header-name {
  font-size     : 12px;
  letter-spacing: 0.06em;
  color         : var(--dash-text);
}
/* ── Per-user avatar colour (— set via --av-col on the element) ─── */
.msg-conv-avatar { color: var(--av-col, var(--dash-accent)); border-color: var(--av-col, var(--dash-accent)); }
.msg-chat-avatar { color: var(--av-col, var(--dash-accent)); border-color: var(--av-col, var(--dash-accent)); }

/* ── Avatar wrappers (needed to position the presence dot) ──── */
.msg-conv-avatar-wrap,
.msg-chat-avatar-wrap {
  position   : relative;
  flex-shrink: 0;
}

/* ── Presence dot ──────────────────────────────────────────── */
.msg-presence-dot {
  position     : absolute;
  bottom       : 0;
  right        : 0;
  width        : 8px;
  height       : 8px;
  border-radius: 50%;
  background   : rgba(180, 190, 215, 0.2);
  border       : 2px solid var(--dash-surface2, #12141e);
  transition   : background 0.3s;
}
.msg-presence-dot--on { background: #44dd88; }

/* ── Photo overlay (inside avatar div) ───────────────────── */
.msg-av-photo {
  position     : absolute;
  inset        : 0;
  width        : 100%;
  height       : 100%;
  border-radius: 50%;
  object-fit   : cover;
}

/* ── Role badge next to username in Messages ─────────────── */
.msg-role-badge {
  font-family   : var(--font-mono);
  font-size     : 7.5px;
  letter-spacing: 0.16em;
  padding       : 1px 5px;
  border-radius : 3px;
  border        : 1px solid rgba(0,212,255,0.2);
  color         : var(--dash-accent);
  background    : rgba(0,212,255,0.05);
  vertical-align: middle;
  margin-left   : 5px;
  text-transform: uppercase;
}
.msg-role-badge[data-role="owner"] { border-color:rgba(245,166,35,0.4);  color:#f5a623; background:rgba(245,166,35,0.07); }
.msg-role-badge[data-role="admin"] { border-color:rgba(168,85,247,0.4);  color:#a855f7; background:rgba(168,85,247,0.07); }
.msg-role-badge[data-role="mod"]   { border-color:rgba(68,221,136,0.4);  color:#44dd88; background:rgba(68,221,136,0.07); }

/* ── Chat header online/offline status text ──────────────── */
.msg-chat-status {
  font-size     : 10px;
  letter-spacing: 0.06em;
  color         : var(--dash-text-faint);
  margin-top    : 1px;
}

/* ─────────────────────────────────────────────────────────────────
   NEW: Message row layout (avatar + name + bubble grouping)
   ─────────────────────────────────────────────────────────────── */
.msg-chat-feed {
  gap: 4px;   /* tighter gap between rows now */
}

.msg-row {
  display       : flex;
  align-items   : flex-end;
  gap           : 8px;
  padding       : 1px 0;
}
.msg-row--self  { flex-direction: row-reverse; }
.msg-row--continued { margin-top: 1px; }

/* Avatar column */
.msg-row-av-wrap {
  flex-shrink: 0;
  width      : 32px;
}
.msg-row-av-wrap--hidden { visibility: hidden; }
.msg-row-av {
  width           : 32px;
  height          : 32px;
  border-radius   : 50%;
  background      : rgba(0,212,255,.1);
  border          : 1px solid rgba(0,212,255,.2);
  display         : flex;
  align-items     : center;
  justify-content : center;
  font-size       : 13px;
  font-weight     : 700;
  color           : var(--av-col, var(--dash-accent));
  border-color    : var(--av-col, var(--dash-accent));
  overflow        : hidden;
  position        : relative;
  flex-shrink     : 0;
  transition      : filter .15s;
}
.msg-row-av:hover { filter: brightness(1.15); }
.msg-row-av img   {
  position     : absolute;
  inset        : 0;
  width        : 100%;
  height       : 100%;
  border-radius: 50%;
  object-fit   : cover;
}

/* Content column */
.msg-row-content {
  display        : flex;
  flex-direction : column;
  align-items    : flex-start;
  max-width      : 75%;
}
.msg-row--self .msg-row-content { align-items: flex-end; }

/* Sender name label */
.msg-row-name {
  font-size     : 9.5px;
  font-weight   : 700;
  color         : var(--dash-text-dim);
  letter-spacing: .06em;
  margin-bottom : 2px;
  padding-left  : 2px;
}
.msg-row-name--self { color: var(--dash-accent); padding-left: 0; padding-right: 2px; }

/* Override old .msg-bubble positioning inside rows */
.msg-row .msg-bubble {
  max-width  : 100%;
  align-self : auto;
}

/* ── Typing indicator (animated dots) ───────────────────────── */
.msg-status--typing { color: #a855f7 !important; }

@keyframes msg-typing-dot {
  0%, 80%, 100% { opacity: .25; transform: translateY(0); }
  40%           { opacity: 1;   transform: translateY(-3px); }
}

.msg-typing-indicator {
  display    : flex;
  gap        : 3px;
  align-items: center;
  padding    : 8px 14px;
  background : var(--dash-surface3);
  border     : 1px solid var(--dash-border);
  border-radius: 8px 8px 8px 2px;
  width      : fit-content;
}
.msg-typing-dot {
  width           : 5px;
  height          : 5px;
  border-radius   : 50%;
  background      : var(--dash-text-faint);
  animation       : msg-typing-dot 1.2s ease-in-out infinite;
}
.msg-typing-dot:nth-child(2) { animation-delay: .2s; }
.msg-typing-dot:nth-child(3) { animation-delay: .4s; }

/* ── DND / Away dot variants ────────────────────────────────── */
.msg-presence-dot--dnd  { background: #ff4d6a; }
.msg-presence-dot--away { background: #f5a623; }
